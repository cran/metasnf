<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Distance Metrics</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Distance Metrics</h1>


<div id="TOC">
<ul>
<li><a href="#distance-functions" id="toc-distance-functions">Distance
functions</a></li>
<li><a href="#how-the-dist_fns_list-is-used" id="toc-how-the-dist_fns_list-is-used">How the dist_fns_list is
used</a></li>
<li><a href="#removing-the-default-distance_metrics" id="toc-removing-the-default-distance_metrics">Removing the default
distance_metrics</a></li>
<li><a href="#supplying-weights-to-distance-metrics" id="toc-supplying-weights-to-distance-metrics">Supplying weights to
distance metrics</a></li>
<li><a href="#custom-distance-metrics" id="toc-custom-distance-metrics">Custom distance metrics</a></li>
<li><a href="#requesting-metrics" id="toc-requesting-metrics">Requesting
metrics</a></li>
<li><a href="#list-of-prewritten-distance-metrics-functions" id="toc-list-of-prewritten-distance-metrics-functions">List of
prewritten distance metrics functions</a></li>
<li><a href="#references" id="toc-references">References</a></li>
</ul>
</div>

<style>
div.aside { background-color:#fff2e6; }
</style>
<p>Download a copy of the vignette to follow along here: <a href="https://raw.githubusercontent.com/BRANCHlab/metasnf/main/vignettes/distance_metrics.Rmd">distance_metrics.Rmd</a></p>
<div id="distance-functions" class="section level2">
<h2>Distance functions</h2>
<p>metasnf enables users to customize what distance metrics are used in
the SNF pipeline. All information about distance metrics are stored in a
<code>dist_fns_list</code> object.</p>
<p>When no relevant arguments are provided, <code>snf_config()</code>
will create its own <code>dist_fns_list</code> class object by calling
the <code>dist_fns_list()</code> function with an argument indicating
that the list should be populated with default distance functions.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(metasnf)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>dl <span class="ot">&lt;-</span> <span class="fu">data_list</span>(</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>    <span class="fu">list</span>(anxiety, <span class="st">&quot;anxiety&quot;</span>, <span class="st">&quot;behaviour&quot;</span>, <span class="st">&quot;ordinal&quot;</span>),</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>    <span class="fu">list</span>(depress, <span class="st">&quot;depressed&quot;</span>, <span class="st">&quot;behaviour&quot;</span>, <span class="st">&quot;ordinal&quot;</span>),</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>    <span class="at">uid =</span> <span class="st">&quot;unique_id&quot;</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>sc <span class="ot">&lt;-</span> <span class="fu">snf_config</span>(</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>    <span class="at">dl =</span> dl,</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>    <span class="at">n_solutions =</span> <span class="dv">5</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>)</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="co">#&gt; ℹ No distance functions specified. Using defaults.</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="co">#&gt; ℹ No clustering functions specified. Using defaults.</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>sc<span class="sc">$</span><span class="st">&quot;dist_fns_list&quot;</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="co">#&gt; Continuous (1):</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a><span class="co">#&gt; [1] euclidean_distance</span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a><span class="co">#&gt; Discrete (1):</span></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a><span class="co">#&gt; [1] euclidean_distance</span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a><span class="co">#&gt; Ordinal (1):</span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a><span class="co">#&gt; [1] euclidean_distance</span></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a><span class="co">#&gt; Categorical (1):</span></span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a><span class="co">#&gt; [1] gower_distance</span></span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a><span class="co">#&gt; Mixed (1):</span></span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a><span class="co">#&gt; [1] gower_distance</span></span></code></pre></div>
<p>The list is a list of functions (<code>euclidean_distance()</code>
and <code>gower_distance()</code> in this case).</p>
<p>These lists can contain any number of distance metrics for each of
the 5 recognized types of features: continuous, discrete, ordinal,
categorical, and mixed (any combination of the previous four).</p>
<p>By default, continuous, discrete, and ordinal data are converted to
distance matrices using simple Euclidean distance. Categorical and mixed
data are handled using Gower’s formula as implemented by the cluster
package (see <code>?cluster::daisy</code>).</p>
</div>
<div id="how-the-dist_fns_list-is-used" class="section level2">
<h2>How the dist_fns_list is used</h2>
<p>To show how the dist_fns_list is used, we’ll start by extending our
dist_fns_list beyond just the default options. metasnf provides a
Euclidean distance function that applies standard normalization first,
<code>sn_euclidean_distance()</code> (a wrapper around
<code>SNFtool::standardNormalization</code> + <code>stats::dist</code>).
Here’s how we can create a custom dist_fns_list that includes this
metric for continuous and discrete features.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>sc <span class="ot">&lt;-</span> <span class="fu">snf_config</span>(</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>    <span class="at">dl =</span> dl,</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>    <span class="at">n_solutions =</span> <span class="dv">10</span>,</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>    <span class="at">cnt_dist_fns =</span> <span class="fu">list</span>(<span class="st">&quot;standard_norm_euclidean&quot;</span> <span class="ot">=</span> sn_euclidean_distance),</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>    <span class="at">dsc_dist_fns =</span> <span class="fu">list</span>(<span class="st">&quot;standard_norm_euclidean&quot;</span> <span class="ot">=</span> sn_euclidean_distance),</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>    <span class="at">use_default_dist_fns =</span> <span class="cn">TRUE</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>)</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co">#&gt; ℹ No clustering functions specified. Using defaults.</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>sc</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="co">#&gt; Settings Data Frame:</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="co">#&gt;                1    2    3    4    5    6    7    8    9   10</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="co">#&gt; SNF hyperparameters:</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="co">#&gt; alpha        0.3  0.7  0.8  0.4  0.6  0.7  0.4  0.3  0.7  0.8</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="co">#&gt; k             52   20   28   92   29   81   15   28   31   87  </span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="co">#&gt; t             20   20   20   20   20   20   20   20   20   20  </span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a><span class="co">#&gt; SNF scheme:</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a><span class="co">#&gt;                3    2    3    2    2    1    3    3    3    3  </span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a><span class="co">#&gt; Clustering functions:</span></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a><span class="co">#&gt;                2    1    1    1    2    1    1    2    2    1  </span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a><span class="co">#&gt; Distance functions:</span></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a><span class="co">#&gt; CNT            1    2    1    1    2    1    2    2    2    1  </span></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a><span class="co">#&gt; DSC            2    1    1    1    1    2    2    1    1    2  </span></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a><span class="co">#&gt; ORD            1    1    1    1    1    1    1    1    1    1  </span></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a><span class="co">#&gt; CAT            1    1    1    1    1    1    1    1    1    1  </span></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a><span class="co">#&gt; MIX            1    1    1    1    1    1    1    1    1    1  </span></span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a><span class="co">#&gt; Component dropout:</span></span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a><span class="co">#&gt; anxiety        ✔    ✔    ✔    ✖    ✔    ✔    ✔    ✔    ✔    ✔  </span></span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a><span class="co">#&gt; depressed      ✔    ✔    ✔    ✔    ✔    ✔    ✔    ✔    ✔    ✔  </span></span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a><span class="co">#&gt; Distance Functions List:</span></span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a><span class="co">#&gt; Continuous (2):</span></span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a><span class="co">#&gt; [1] euclidean_distance</span></span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a><span class="co">#&gt; [2] standard_norm_euclidean</span></span>
<span id="cb2-34"><a href="#cb2-34" tabindex="-1"></a><span class="co">#&gt; Discrete (2):</span></span>
<span id="cb2-35"><a href="#cb2-35" tabindex="-1"></a><span class="co">#&gt; [1] euclidean_distance</span></span>
<span id="cb2-36"><a href="#cb2-36" tabindex="-1"></a><span class="co">#&gt; [2] standard_norm_euclidean</span></span>
<span id="cb2-37"><a href="#cb2-37" tabindex="-1"></a><span class="co">#&gt; Ordinal (1):</span></span>
<span id="cb2-38"><a href="#cb2-38" tabindex="-1"></a><span class="co">#&gt; [1] euclidean_distance</span></span>
<span id="cb2-39"><a href="#cb2-39" tabindex="-1"></a><span class="co">#&gt; Categorical (1):</span></span>
<span id="cb2-40"><a href="#cb2-40" tabindex="-1"></a><span class="co">#&gt; [1] gower_distance</span></span>
<span id="cb2-41"><a href="#cb2-41" tabindex="-1"></a><span class="co">#&gt; Mixed (1):</span></span>
<span id="cb2-42"><a href="#cb2-42" tabindex="-1"></a><span class="co">#&gt; [1] gower_distance</span></span>
<span id="cb2-43"><a href="#cb2-43" tabindex="-1"></a><span class="co">#&gt; Clustering Functions List:</span></span>
<span id="cb2-44"><a href="#cb2-44" tabindex="-1"></a><span class="co">#&gt; [1] spectral_eigen</span></span>
<span id="cb2-45"><a href="#cb2-45" tabindex="-1"></a><span class="co">#&gt; [2] spectral_rot</span></span>
<span id="cb2-46"><a href="#cb2-46" tabindex="-1"></a><span class="co">#&gt; Weights Matrix:</span></span>
<span id="cb2-47"><a href="#cb2-47" tabindex="-1"></a><span class="co">#&gt; Weights defined for 10 cluster solutions.</span></span>
<span id="cb2-48"><a href="#cb2-48" tabindex="-1"></a><span class="co">#&gt; $ cbcl_anxiety_r  1, 1, 1, 1, 1, 1, 1, 1, 1, 1</span></span>
<span id="cb2-49"><a href="#cb2-49" tabindex="-1"></a><span class="co">#&gt; $ cbcl_depress_r  1, 1, 1, 1, 1, 1, 1, 1, 1, 1</span></span></code></pre></div>
<p>The rows in the settings data frame part of the SNF config show the
continuous (CNT) and discrete (DSTC) distance metrics values randomly
fluctuate between 1 and 2, where 1 means that the first metric
(<code>euclidean_distance()</code>) will be used and 2 means that the
second metric (<code>sn_euclidean_distance</code>) will be used.</p>
<p>The settings data frame within the config stores pointers to which
function should be used, while the distance functions list in the config
stores the actual functions.</p>
<p>Once you have an SNF config that contains a distance functions list
to your liking, you can call <code>batch_snf()</code> as usual:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>sol_df <span class="ot">&lt;-</span> <span class="fu">batch_snf</span>(dl, sc)</span></code></pre></div>
</div>
<div id="removing-the-default-distance_metrics" class="section level2">
<h2>Removing the default distance_metrics</h2>
<p>There are two ways to avoid using the default distance metrics.</p>
<p>The first way is to use the <code>use_default_dist_fns</code>
parameter:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>sc <span class="ot">&lt;-</span> <span class="fu">snf_config</span>(</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>    <span class="at">dl =</span> dl,</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>    <span class="at">n_solutions =</span> <span class="dv">10</span>,</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>    <span class="at">cnt_dist_fns =</span> <span class="fu">list</span>(<span class="st">&quot;standard_norm_euclidean&quot;</span> <span class="ot">=</span> sn_euclidean_distance),</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>    <span class="at">dsc_dist_fns =</span> <span class="fu">list</span>(<span class="st">&quot;standard_norm_euclidean&quot;</span> <span class="ot">=</span> sn_euclidean_distance),</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>    <span class="at">ord_dist_fns =</span> <span class="fu">list</span>(<span class="st">&quot;standard_norm_euclidean&quot;</span> <span class="ot">=</span> sn_euclidean_distance),</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>    <span class="at">mix_dist_fns =</span> <span class="fu">list</span>(<span class="st">&quot;standard_norm_euclidean&quot;</span> <span class="ot">=</span> gower_distance),</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>    <span class="at">use_default_dist_fns =</span> <span class="cn">FALSE</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>)</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co">#&gt; ℹ No clustering functions specified. Using defaults.</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>sc</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="co">#&gt; Settings Data Frame:</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="co">#&gt;                1    2    3    4    5    6    7    8    9   10</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="co">#&gt; SNF hyperparameters:</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="co">#&gt; alpha        0.3  0.3  0.5  0.6  0.6  0.4  0.8  0.4  0.4  0.6</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="co">#&gt; k             28   46   80   40   65   53   79   76   45   63  </span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a><span class="co">#&gt; t             20   20   20   20   20   20   20   20   20   20  </span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a><span class="co">#&gt; SNF scheme:</span></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a><span class="co">#&gt;                1    3    2    3    1    1    2    2    2    2  </span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a><span class="co">#&gt; Clustering functions:</span></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a><span class="co">#&gt;                2    2    2    1    2    2    1    1    1    2  </span></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a><span class="co">#&gt; Distance functions:</span></span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a><span class="co">#&gt; CNT            1    1    1    1    1    1    1    1    1    1  </span></span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a><span class="co">#&gt; DSC            1    1    1    1    1    1    1    1    1    1  </span></span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a><span class="co">#&gt; ORD            1    1    1    1    1    1    1    1    1    1  </span></span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a><span class="co">#&gt; CAT            0    0    0    0    0    0    0    0    0    0  </span></span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a><span class="co">#&gt; MIX            1    1    1    1    1    1    1    1    1    1  </span></span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a><span class="co">#&gt; Component dropout:</span></span>
<span id="cb4-30"><a href="#cb4-30" tabindex="-1"></a><span class="co">#&gt; anxiety        ✔    ✔    ✔    ✔    ✔    ✔    ✔    ✔    ✔    ✔  </span></span>
<span id="cb4-31"><a href="#cb4-31" tabindex="-1"></a><span class="co">#&gt; depressed      ✔    ✔    ✔    ✔    ✔    ✔    ✔    ✔    ✔    ✔  </span></span>
<span id="cb4-32"><a href="#cb4-32" tabindex="-1"></a><span class="co">#&gt; Distance Functions List:</span></span>
<span id="cb4-33"><a href="#cb4-33" tabindex="-1"></a><span class="co">#&gt; Continuous (1):</span></span>
<span id="cb4-34"><a href="#cb4-34" tabindex="-1"></a><span class="co">#&gt; [1] standard_norm_euclidean</span></span>
<span id="cb4-35"><a href="#cb4-35" tabindex="-1"></a><span class="co">#&gt; Discrete (1):</span></span>
<span id="cb4-36"><a href="#cb4-36" tabindex="-1"></a><span class="co">#&gt; [1] standard_norm_euclidean</span></span>
<span id="cb4-37"><a href="#cb4-37" tabindex="-1"></a><span class="co">#&gt; Ordinal (1):</span></span>
<span id="cb4-38"><a href="#cb4-38" tabindex="-1"></a><span class="co">#&gt; [1] standard_norm_euclidean</span></span>
<span id="cb4-39"><a href="#cb4-39" tabindex="-1"></a><span class="co">#&gt; Categorical (0):</span></span>
<span id="cb4-40"><a href="#cb4-40" tabindex="-1"></a><span class="co">#&gt; Mixed (1):</span></span>
<span id="cb4-41"><a href="#cb4-41" tabindex="-1"></a><span class="co">#&gt; [1] standard_norm_euclidean</span></span>
<span id="cb4-42"><a href="#cb4-42" tabindex="-1"></a><span class="co">#&gt; Clustering Functions List:</span></span>
<span id="cb4-43"><a href="#cb4-43" tabindex="-1"></a><span class="co">#&gt; [1] spectral_eigen</span></span>
<span id="cb4-44"><a href="#cb4-44" tabindex="-1"></a><span class="co">#&gt; [2] spectral_rot</span></span>
<span id="cb4-45"><a href="#cb4-45" tabindex="-1"></a><span class="co">#&gt; Weights Matrix:</span></span>
<span id="cb4-46"><a href="#cb4-46" tabindex="-1"></a><span class="co">#&gt; Weights defined for 10 cluster solutions.</span></span>
<span id="cb4-47"><a href="#cb4-47" tabindex="-1"></a><span class="co">#&gt; $ cbcl_anxiety_r  1, 1, 1, 1, 1, 1, 1, 1, 1, 1</span></span>
<span id="cb4-48"><a href="#cb4-48" tabindex="-1"></a><span class="co">#&gt; $ cbcl_depress_r  1, 1, 1, 1, 1, 1, 1, 1, 1, 1</span></span></code></pre></div>
<p>The second way is to explicitly specify which indices you want to
sample from during SNF config generation:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>sc <span class="ot">&lt;-</span> <span class="fu">snf_config</span>(</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>    <span class="at">dl =</span> dl,</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>    <span class="at">n_solutions =</span> <span class="dv">10</span>,</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>    <span class="at">cnt_dist_fns =</span> <span class="fu">list</span>(</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>        <span class="st">&quot;standard_norm_euclidean&quot;</span> <span class="ot">=</span> sn_euclidean_distance,</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>        <span class="st">&quot;some_other_metric&quot;</span> <span class="ot">=</span> sn_euclidean_distance</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>    ),</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>    <span class="at">dsc_dist_fns =</span> <span class="fu">list</span>(</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>        <span class="st">&quot;standard_norm_euclidean&quot;</span> <span class="ot">=</span> sn_euclidean_distance,</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>        <span class="st">&quot;some_other_metric&quot;</span> <span class="ot">=</span> sn_euclidean_distance</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>    ),</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>    <span class="at">use_default_dist_fns =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>    <span class="at">continuous_distances =</span> <span class="dv">1</span>,</span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>    <span class="at">discrete_distances =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>)</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="co">#&gt; ℹ No clustering functions specified. Using defaults.</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>sc</span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a><span class="co">#&gt; Settings Data Frame:</span></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a><span class="co">#&gt;                1    2    3    4    5    6    7    8    9   10</span></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a><span class="co">#&gt; SNF hyperparameters:</span></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a><span class="co">#&gt; alpha        0.7  0.8  0.8  0.6  0.6  0.5  0.4  0.7  0.3  0.7</span></span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a><span class="co">#&gt; k             34   73   89   51   97   75   15   51   26   71  </span></span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a><span class="co">#&gt; t             20   20   20   20   20   20   20   20   20   20  </span></span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a><span class="co">#&gt; SNF scheme:</span></span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a><span class="co">#&gt;                2    2    1    2    2    3    3    3    3    2  </span></span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a><span class="co">#&gt; Clustering functions:</span></span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a><span class="co">#&gt;                1    2    1    2    1    2    2    2    2    1  </span></span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a><span class="co">#&gt; Distance functions:</span></span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a><span class="co">#&gt; CNT            1    1    1    1    1    1    1    1    1    1  </span></span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a><span class="co">#&gt; DSC            2    2    3    2    3    2    3    2    2    3  </span></span>
<span id="cb5-32"><a href="#cb5-32" tabindex="-1"></a><span class="co">#&gt; ORD            1    1    1    1    1    1    1    1    1    1  </span></span>
<span id="cb5-33"><a href="#cb5-33" tabindex="-1"></a><span class="co">#&gt; CAT            1    1    1    1    1    1    1    1    1    1  </span></span>
<span id="cb5-34"><a href="#cb5-34" tabindex="-1"></a><span class="co">#&gt; MIX            1    1    1    1    1    1    1    1    1    1  </span></span>
<span id="cb5-35"><a href="#cb5-35" tabindex="-1"></a><span class="co">#&gt; Component dropout:</span></span>
<span id="cb5-36"><a href="#cb5-36" tabindex="-1"></a><span class="co">#&gt; anxiety        ✔    ✔    ✔    ✔    ✔    ✔    ✔    ✔    ✔    ✔  </span></span>
<span id="cb5-37"><a href="#cb5-37" tabindex="-1"></a><span class="co">#&gt; depressed      ✔    ✔    ✔    ✔    ✔    ✔    ✔    ✔    ✔    ✔  </span></span>
<span id="cb5-38"><a href="#cb5-38" tabindex="-1"></a><span class="co">#&gt; Distance Functions List:</span></span>
<span id="cb5-39"><a href="#cb5-39" tabindex="-1"></a><span class="co">#&gt; Continuous (3):</span></span>
<span id="cb5-40"><a href="#cb5-40" tabindex="-1"></a><span class="co">#&gt; [1] euclidean_distance</span></span>
<span id="cb5-41"><a href="#cb5-41" tabindex="-1"></a><span class="co">#&gt; [2] standard_norm_euclidean</span></span>
<span id="cb5-42"><a href="#cb5-42" tabindex="-1"></a><span class="co">#&gt; [3] some_other_metric</span></span>
<span id="cb5-43"><a href="#cb5-43" tabindex="-1"></a><span class="co">#&gt; Discrete (3):</span></span>
<span id="cb5-44"><a href="#cb5-44" tabindex="-1"></a><span class="co">#&gt; [1] euclidean_distance</span></span>
<span id="cb5-45"><a href="#cb5-45" tabindex="-1"></a><span class="co">#&gt; [2] standard_norm_euclidean</span></span>
<span id="cb5-46"><a href="#cb5-46" tabindex="-1"></a><span class="co">#&gt; [3] some_other_metric</span></span>
<span id="cb5-47"><a href="#cb5-47" tabindex="-1"></a><span class="co">#&gt; Ordinal (1):</span></span>
<span id="cb5-48"><a href="#cb5-48" tabindex="-1"></a><span class="co">#&gt; [1] euclidean_distance</span></span>
<span id="cb5-49"><a href="#cb5-49" tabindex="-1"></a><span class="co">#&gt; Categorical (1):</span></span>
<span id="cb5-50"><a href="#cb5-50" tabindex="-1"></a><span class="co">#&gt; [1] gower_distance</span></span>
<span id="cb5-51"><a href="#cb5-51" tabindex="-1"></a><span class="co">#&gt; Mixed (1):</span></span>
<span id="cb5-52"><a href="#cb5-52" tabindex="-1"></a><span class="co">#&gt; [1] gower_distance</span></span>
<span id="cb5-53"><a href="#cb5-53" tabindex="-1"></a><span class="co">#&gt; Clustering Functions List:</span></span>
<span id="cb5-54"><a href="#cb5-54" tabindex="-1"></a><span class="co">#&gt; [1] spectral_eigen</span></span>
<span id="cb5-55"><a href="#cb5-55" tabindex="-1"></a><span class="co">#&gt; [2] spectral_rot</span></span>
<span id="cb5-56"><a href="#cb5-56" tabindex="-1"></a><span class="co">#&gt; Weights Matrix:</span></span>
<span id="cb5-57"><a href="#cb5-57" tabindex="-1"></a><span class="co">#&gt; Weights defined for 10 cluster solutions.</span></span>
<span id="cb5-58"><a href="#cb5-58" tabindex="-1"></a><span class="co">#&gt; $ cbcl_anxiety_r  1, 1, 1, 1, 1, 1, 1, 1, 1, 1</span></span>
<span id="cb5-59"><a href="#cb5-59" tabindex="-1"></a><span class="co">#&gt; $ cbcl_depress_r  1, 1, 1, 1, 1, 1, 1, 1, 1, 1</span></span></code></pre></div>
<p>This can save you the trouble of needing to manage several distinct
distance metrics lists or manage your solution space over separate runs
of <code>batch_snf</code>.</p>
</div>
<div id="supplying-weights-to-distance-metrics" class="section level2">
<h2>Supplying weights to distance metrics</h2>
<p>Some distance metric functions can accept weights. Usually, weights
will be applied by direct scaling of specified features. In some cases
(e.g. categorical distance metric functions), the way in which weights
are applied may be somewhat less intuitive. The bottom of this vignette
outlines the available distance metric functions grouped by whether or
not they accept weights. You can examine the documentation of those
weighted functions to learn more about how the weights you provide will
be used.</p>
<p>An important note on providing weights for a run of SNF is that the
specific form of the data may not be what you expect by the time it is
ready to be converted into a distance metric function. The “individual”
and “two-step” SNF schemes involve distance metrics only being applied
to the input data frames in the data list as they are. The “domain”
scheme, however, concatenates data within a domain before converting
that larger data frame into a distance matrix. Anytime you have more
than one data frame with the same domain label and you use the domain
SNF scheme, all the columns associated with that domain will be in a
single data frame when the distance metric function is applied.</p>
<p>By default, <code>snf_config()</code> also defines the
<code>weights_matrix</code> class object that stores feature weights.
Without any user provided weights, these weights are just initialized to
1.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>sc<span class="sc">$</span><span class="st">&quot;weights_matrix&quot;</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="co">#&gt; Weights defined for 10 cluster solutions.</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co">#&gt; $ cbcl_anxiety_r  1, 1, 1, 1, 1, 1, 1, 1, 1, 1</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co">#&gt; $ cbcl_depress_r  1, 1, 1, 1, 1, 1, 1, 1, 1, 1</span></span></code></pre></div>
<p>To actually use the matrix during SNF, you’ll need to make sure that
the number of rows in the weights matrix is the same as the number of
rows in your settings data frame.</p>
<p>You can either replace the 1s with your own weights that you’ve
calculated outside of the package, or use some random weights following
a uniform or exponential distribution.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># random weights:</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>sc <span class="ot">&lt;-</span> <span class="fu">snf_config</span>(</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>    <span class="at">dl =</span> dl,</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>    <span class="at">n_solutions =</span> <span class="dv">10</span>,</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>    <span class="at">weights_fill =</span> <span class="st">&quot;uniform&quot;</span> <span class="co"># or fill = &quot;exponential&quot;</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>)</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>sc</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="co"># custom weights</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>fts <span class="ot">&lt;-</span> <span class="fu">features</span>(dl)</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>custom_wm <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">10</span>, <span class="at">ncol =</span> <span class="fu">length</span>(fts), <span class="fu">rnorm</span>(<span class="dv">10</span> <span class="sc">*</span> <span class="fu">length</span>(fts))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="fu">colnames</span>(custom_wm) <span class="ot">&lt;-</span> fts</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>custom_wm <span class="ot">&lt;-</span> <span class="fu">as_weights_matrix</span>(custom_wm)</span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>sc <span class="ot">&lt;-</span> <span class="fu">snf_config</span>(</span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>    <span class="at">dl =</span> dl,</span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>    <span class="at">n_solutions =</span> <span class="dv">10</span>,</span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>    <span class="at">wm =</span> custom_wm</span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a>)</span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a>sc</span></code></pre></div>
<p>The default metrics (simple Euclidean for continuous, discrete, and
ordinal data and Gower’s distance for categorical and mixed data) are
both capable of applying weights to data before distance matrix
generation.</p>
</div>
<div id="custom-distance-metrics" class="section level2">
<h2>Custom distance metrics</h2>
<p>The remainder of this vignette deals with supplying custom distance
metrics (including custom feature weighting). Making use of this
functionality will require a good understanding of working with
functions in R.</p>
<p>You can also supply your own custom distance metrics. Looking at the
code from one of the package-provided distance functions shows some of
the essential aspects of a well-formated distance function.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>euclidean_distance</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="co">#&gt; function (df, weights_row) </span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co">#&gt; {</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co">#&gt;     weights &lt;- diag(weights_row, nrow = length(weights_row))</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co">#&gt;     weighted_df &lt;- as.matrix(df) %*% weights</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">#&gt;     distance_matrix &lt;- as.matrix(stats::dist(weighted_df, method = &quot;euclidean&quot;))</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co">#&gt;     return(distance_matrix)</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">#&gt; }</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#&gt; &lt;bytecode: 0x654c10a62368&gt;</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#&gt; &lt;environment: namespace:metasnf&gt;</span></span></code></pre></div>
<p>The function should accept two arguments: <code>df</code> and
<code>weights_row</code>, and only give one output,
<code>distance_matrix</code>. The function doesn’t actually need to make
use of those weights if you don’t want it to.</p>
<p>By the time your data reaches a distance metric function, it
(referred to as <code>df</code>) will always:</p>
<ol style="list-style-type: decimal">
<li>have no UID column</li>
<li>have at least one feature column</li>
<li>have no missing values</li>
<li>be a data.frame (not a tibble)</li>
</ol>
<p>The feature column names won’t be altered from the values they had
when they were loaded into the data_list.</p>
<p>For example, consider the <code>anxiety</code> raw data supplied by
metasnf:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">head</span>(anxiety)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 2</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="co">#&gt;   unique_id        cbcl_anxiety_r</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                     &lt;dbl&gt;</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">#&gt; 1 NDAR_INV0567T2Y9              3</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co">#&gt; 2 NDAR_INV0J4PYA5F              0</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co">#&gt; 3 NDAR_INV10OMKVLE              3</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="co">#&gt; 4 NDAR_INV15FPCW4O              0</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co">#&gt; 5 NDAR_INV19NB4RJK              0</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co">#&gt; 6 NDAR_INV1HLGR738              2</span></span></code></pre></div>
<p>Here’s how to make it look more like what the distance metric
functions will expect to see:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>processed_anxiety <span class="ot">&lt;-</span> anxiety <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>    <span class="fu">na.omit</span>() <span class="sc">|&gt;</span> <span class="co"># no NAs</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;uid&quot;</span> <span class="ot">=</span> <span class="st">&quot;unique_id&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="at">row.names =</span> <span class="st">&quot;uid&quot;</span>)</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="fu">head</span>(processed_anxiety)</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">#&gt;                  cbcl_anxiety_r</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co">#&gt; NDAR_INV0567T2Y9              3</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co">#&gt; NDAR_INV0J4PYA5F              0</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co">#&gt; NDAR_INV10OMKVLE              3</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co">#&gt; NDAR_INV15FPCW4O              0</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">#&gt; NDAR_INV19NB4RJK              0</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co">#&gt; NDAR_INV1HLGR738              2</span></span></code></pre></div>
<p>If we want to have a distance metric that calculates Euclidean
distance, but also scales the resulting matrix down such that the
biggest allowed distance is a 1, it would look like this:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>my_scaled_euclidean <span class="ot">&lt;-</span> <span class="cf">function</span>(df, weights_row) {</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>    <span class="co"># this function won&#39;t apply the weights it is given</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>    distance_matrix <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>        stats<span class="sc">::</span><span class="fu">dist</span>(<span class="at">method =</span> <span class="st">&quot;euclidean&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>        <span class="fu">as.matrix</span>() <span class="co"># make sure it&#39;s formatted as a matrix</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>    distance_matrix <span class="ot">&lt;-</span> distance_matrix <span class="sc">/</span> <span class="fu">max</span>(distance_matrix)</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>    <span class="fu">return</span>(distance_matrix)</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>}</span></code></pre></div>
<p>You’ll need to be mindful of any edge cases that your function will
run into. For example, this function will fail if the pairwise distances
for all patients is 0 (a division by 0 will occur). If that specific
situation ever happens, there’s probably something quite wrong with the
data.</p>
<p>Once you’re happy that you distance function is working as you’d like
it to:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">my_scaled_euclidean</span>(processed_anxiety)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="co">#&gt;                  NDAR_INV0567T2Y9 NDAR_INV0J4PYA5F NDAR_INV10OMKVLE</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="co">#&gt; NDAR_INV0567T2Y9              0.0              0.3              0.0</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="co">#&gt; NDAR_INV0J4PYA5F              0.3              0.0              0.3</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="co">#&gt; NDAR_INV10OMKVLE              0.0              0.3              0.0</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="co">#&gt; NDAR_INV15FPCW4O              0.3              0.0              0.3</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co">#&gt; NDAR_INV19NB4RJK              0.3              0.0              0.3</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="co">#&gt;                  NDAR_INV15FPCW4O NDAR_INV19NB4RJK</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="co">#&gt; NDAR_INV0567T2Y9              0.3              0.3</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="co">#&gt; NDAR_INV0J4PYA5F              0.0              0.0</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="co">#&gt; NDAR_INV10OMKVLE              0.3              0.3</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="co">#&gt; NDAR_INV15FPCW4O              0.0              0.0</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="co">#&gt; NDAR_INV19NB4RJK              0.0              0.0</span></span></code></pre></div>
<p>You can load it into the distance functions list during SNF config
construction:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>sc <span class="ot">&lt;-</span> <span class="fu">snf_config</span>(</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>    <span class="at">n_solutions =</span> <span class="dv">10</span>,</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>    <span class="at">dl =</span> dl,</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>    <span class="at">cnt_dist_fns =</span> <span class="fu">list</span>(</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>        <span class="st">&quot;my_scaled_euclidean&quot;</span> <span class="ot">=</span> my_scaled_euclidean</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>    ),</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>    <span class="at">use_default_dist_fns =</span> <span class="cn">TRUE</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>)</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="co">#&gt; ℹ No clustering functions specified. Using defaults.</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>sc</span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a><span class="co">#&gt; Settings Data Frame:</span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a><span class="co">#&gt;                1    2    3    4    5    6    7    8    9   10</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a><span class="co">#&gt; SNF hyperparameters:</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a><span class="co">#&gt; alpha        0.7  0.6  0.3  0.6  0.4  0.4  0.5  0.5  0.3  0.7</span></span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a><span class="co">#&gt; k             43   25   78   98   43   13   83   64   92   41  </span></span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a><span class="co">#&gt; t             20   20   20   20   20   20   20   20   20   20  </span></span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a><span class="co">#&gt; SNF scheme:</span></span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a><span class="co">#&gt;                2    2    3    3    2    3    1    3    1    1  </span></span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a><span class="co">#&gt; Clustering functions:</span></span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a><span class="co">#&gt;                2    2    2    1    1    2    1    2    2    1  </span></span>
<span id="cb13-22"><a href="#cb13-22" tabindex="-1"></a><span class="co">#&gt; Distance functions:</span></span>
<span id="cb13-23"><a href="#cb13-23" tabindex="-1"></a><span class="co">#&gt; CNT            2    2    1    1    1    2    2    2    1    2  </span></span>
<span id="cb13-24"><a href="#cb13-24" tabindex="-1"></a><span class="co">#&gt; DSC            1    1    1    1    1    1    1    1    1    1  </span></span>
<span id="cb13-25"><a href="#cb13-25" tabindex="-1"></a><span class="co">#&gt; ORD            1    1    1    1    1    1    1    1    1    1  </span></span>
<span id="cb13-26"><a href="#cb13-26" tabindex="-1"></a><span class="co">#&gt; CAT            1    1    1    1    1    1    1    1    1    1  </span></span>
<span id="cb13-27"><a href="#cb13-27" tabindex="-1"></a><span class="co">#&gt; MIX            1    1    1    1    1    1    1    1    1    1  </span></span>
<span id="cb13-28"><a href="#cb13-28" tabindex="-1"></a><span class="co">#&gt; Component dropout:</span></span>
<span id="cb13-29"><a href="#cb13-29" tabindex="-1"></a><span class="co">#&gt; anxiety        ✔    ✔    ✔    ✔    ✔    ✔    ✔    ✔    ✔    ✔  </span></span>
<span id="cb13-30"><a href="#cb13-30" tabindex="-1"></a><span class="co">#&gt; depressed      ✔    ✔    ✔    ✔    ✔    ✔    ✔    ✔    ✔    ✔  </span></span>
<span id="cb13-31"><a href="#cb13-31" tabindex="-1"></a><span class="co">#&gt; Distance Functions List:</span></span>
<span id="cb13-32"><a href="#cb13-32" tabindex="-1"></a><span class="co">#&gt; Continuous (2):</span></span>
<span id="cb13-33"><a href="#cb13-33" tabindex="-1"></a><span class="co">#&gt; [1] euclidean_distance</span></span>
<span id="cb13-34"><a href="#cb13-34" tabindex="-1"></a><span class="co">#&gt; [2] my_scaled_euclidean</span></span>
<span id="cb13-35"><a href="#cb13-35" tabindex="-1"></a><span class="co">#&gt; Discrete (1):</span></span>
<span id="cb13-36"><a href="#cb13-36" tabindex="-1"></a><span class="co">#&gt; [1] euclidean_distance</span></span>
<span id="cb13-37"><a href="#cb13-37" tabindex="-1"></a><span class="co">#&gt; Ordinal (1):</span></span>
<span id="cb13-38"><a href="#cb13-38" tabindex="-1"></a><span class="co">#&gt; [1] euclidean_distance</span></span>
<span id="cb13-39"><a href="#cb13-39" tabindex="-1"></a><span class="co">#&gt; Categorical (1):</span></span>
<span id="cb13-40"><a href="#cb13-40" tabindex="-1"></a><span class="co">#&gt; [1] gower_distance</span></span>
<span id="cb13-41"><a href="#cb13-41" tabindex="-1"></a><span class="co">#&gt; Mixed (1):</span></span>
<span id="cb13-42"><a href="#cb13-42" tabindex="-1"></a><span class="co">#&gt; [1] gower_distance</span></span>
<span id="cb13-43"><a href="#cb13-43" tabindex="-1"></a><span class="co">#&gt; Clustering Functions List:</span></span>
<span id="cb13-44"><a href="#cb13-44" tabindex="-1"></a><span class="co">#&gt; [1] spectral_eigen</span></span>
<span id="cb13-45"><a href="#cb13-45" tabindex="-1"></a><span class="co">#&gt; [2] spectral_rot</span></span>
<span id="cb13-46"><a href="#cb13-46" tabindex="-1"></a><span class="co">#&gt; Weights Matrix:</span></span>
<span id="cb13-47"><a href="#cb13-47" tabindex="-1"></a><span class="co">#&gt; Weights defined for 10 cluster solutions.</span></span>
<span id="cb13-48"><a href="#cb13-48" tabindex="-1"></a><span class="co">#&gt; $ cbcl_anxiety_r  1, 1, 1, 1, 1, 1, 1, 1, 1, 1</span></span>
<span id="cb13-49"><a href="#cb13-49" tabindex="-1"></a><span class="co">#&gt; $ cbcl_depress_r  1, 1, 1, 1, 1, 1, 1, 1, 1, 1</span></span></code></pre></div>
</div>
<div id="requesting-metrics" class="section level2">
<h2>Requesting metrics</h2>
<p>If there’s a metric you’d like to see added as a prewritten option
included in the package, feel free to post an issue or make a pull
request on the package’s GitHub.</p>
</div>
<div id="list-of-prewritten-distance-metrics-functions" class="section level2">
<h2>List of prewritten distance metrics functions</h2>
<p>These metrics can be used as is. They are all capable of accepting
and applying custom weights provided by a
<code>weights_matrix</code>.</p>
<ul>
<li><code>euclidean_distance</code> (Euclidean distance)
<ul>
<li>applies to continuous, discrete, or ordinal data</li>
</ul></li>
<li><code>sn_euclidean_distance</code> (Standard normalized Euclidean
distance)
<ul>
<li>Standard normalize data, then use Euclidean distance</li>
<li>applies to continuous, discrete, or ordinal data</li>
</ul></li>
<li><code>gower_distance</code> (Gower’s distance)
<ul>
<li>applies to any data</li>
</ul></li>
<li><code>siw_euclidean_distance</code> (Squared (including weights)
Euclidean distance)
<ul>
<li>Apply weights to data frame, then calculate Euclidean distance, then
square the results</li>
</ul></li>
<li><code>sew_euclidean_distance</code> (Squared (excluding weights)
Euclidean distance)
<ul>
<li>Apply <em>square root</em> of weights to data frame, then calculate
Euclidean distance, then square the results</li>
</ul></li>
<li><code>hamming_distance</code> (Hamming distance)
<ul>
<li>Distance between patients is (1 * feature weight) summed over all
features</li>
</ul></li>
</ul>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<p>Wang, Bo, Aziz M. Mezlini, Feyyaz Demir, Marc Fiume, Zhuowen Tu,
Michael Brudno, Benjamin Haibe-Kains, and Anna Goldenberg. 2014.
“Similarity Network Fusion for Aggregating Data Types on a Genomic
Scale.” Nature Methods 11 (3): 333–37. <a href="https://doi.org/10.1038/nmeth.2810" class="uri">https://doi.org/10.1038/nmeth.2810</a>.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
